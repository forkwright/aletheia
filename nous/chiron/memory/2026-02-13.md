# 2026-02-13: Bootstrap Finalization + Round Robin Dashboard

## What Happened
Continued bootstrap repo work from yesterday. Multiple iteration cycles refining the package based on Cody's feedback and multi-perspective audits. Then pivoted to task work — round robin assignment audit dashboard for Avery/Admin team.

## Bootstrap Redesign Iterations

### Flow Change (Cody's direction)
- Bootstrap is temporary scaffolding, not permanent furniture
- User starts Claude Code in empty folder, tells it to clone bootstrap
- Claude Code handles everything: clones repos, runs setup, onboards user
- After setup works: `rm -rf bootstrap/`
- Users should always use `claude --resume` for session continuity

### Sub-Agent Audit (3 perspectives)
Spawned three sub-agents: new-user walkthrough, security audit, AI-perspective audit.

**Real issues found and fixed:**
1. Graph path resolution off by one (.summus/tools/graph/ is 4 levels, not 3)
2. build_graph.py referenced dead variable `SUMMUS_ROOT` after refactor
3. schema_lookup.py had undefined `SCHEMA_DB_PATHS` variable in error path (crash bug)
4. dm_tests bypass via multi-statement SQL (`SELECT 1 FROM dm_tests; DROP TABLE cases`)
5. Missing COPY/UNLOAD in blocked keywords
6. redshift-guard.sh was dead code (not wired to Claude Code hooks)
7. Memory triggers too vague for LLM to act on
8. Dual CLAUDE.md precedence ambiguity

**Discarded false positives:** hardcoded cluster IDs aren't secrets (config), git push advisory is correct for AI context, env var manipulation assumes machine compromise, most "25 vulnerabilities" were theoretical.

### Cody's Corrections
1. **Remove AWS creds from code** - cluster ID, profile, username all removed. Now uses `.summus/redshift.env` created during onboarding.
2. **Enforce git push blocking** - not just advisory text. Added:
   - PreToolUse hook (git-guard.sh) blocks `git push` in Claude Code
   - Git pre-push hook installed in each repo
   - Force push permanently blocked, no override
   - Regular push override requires `--override-push-guard` flag
3. **Enforce Redshift write blocking** - three layers:
   - PreToolUse hook blocks mutations in bash
   - query_redshift.sh has its own mutation blocking
   - Raw `aws redshift-data execute-statement` calls blocked (must use wrapper)

### Final Commit History (bootstrap repo)
- `clean up docs, add tasks` (initial)
- `consolidate docs into readme + claude.md` (4 repos)
- `redesign: domain knowledge, graph, memory, safety hooks`
- `make bootstrap temporary, generate workspace on setup`
- `simplify: user starts claude, tells it to clone and setup`
- `fix path resolution, wire up hooks, add dep check`
- `fix multi-statement sql bypass, sharpen ai instructions, crash bug in schema lookup`
- `remove hardcoded aws creds, use .summus/redshift.env`
- `enforce git push and redshift write blocking via hooks`

## Admin Meeting Transcript
- Syn handled transcription (whisper tiny on Metis)
- Cody put transcript + summary in Downloads: admin-meeting-feb4-transcript.txt, admin-meeting-feb4-summary.md
- Also: "Round Robin Rules.odt" from Avery — the full rule spec

## Round Robin Audit Dashboard (NEW — main work item)
- Scaffolded: `reporting/dashboards/round_robin/` with README, CLAUDE.md, docs/
- Full requirements doc from transcript + rules doc
- Data mapping: which rules we can audit from Redshift vs what needs app-level
- **Redshift exploration done:**
  - CaseUsers is the assignment table (27K records)
  - First "Summus Partner" role entry per case = round robin assignment (0-3 sec delay)
  - 20 active SPs identified, all with caseload data
  - Self-created override confirmed (creator UserId = assigned SP UserId, delay 0)
  - Timezone distribution: mostly EST, some CST/PST (matches round robin rules)
  - All findings documented in docs/REDSHIFT_EXPLORATION.md
- **Still need from Johnny:**
  - Where rotation type (RSO vs Employer/Consumer) is stored per SP
  - Where weekend coverage flag per SP is stored
  - Where SP threshold configs (25/50/75/100%) live
  - Whether these are in Redshift or app-only
- Next: write core SQL queries, then wire into Hex

## Decisions
- Bootstrap is ephemeral scaffolding
- No AWS creds in committed code ever
- Git push and Redshift writes enforced via hooks, not advisory
- Round robin = new dashboard (not added to existing clin_ops)
- CaseUsers + Role='Summus Partner' is the SP assignment join pattern

## Data Layer Assessment (post-maintenance, ~09:12)
- Cody asked: can we build from existing business_data.public tables, or need a new one?
- Reviewed all 50+ tables in business_data.public via schema DB and DOMAIN_INDEX.md
- **Finding: no existing table covers SP assignment/caseload.**
  - `cases.primary_summus_partner` is just a text name from CaseNote 66, can be "deleted"
  - `cases.first_intake_case_user_id` is NOT the assigned SP — it's who did intake
  - No assignment timestamp, no SP user ID, no auto vs manual distinction
- **Decision: need new table `dm_sp_assignments.sql`** in `data_landscape/sql/core/`
- Proposed columns: case_id, sp_user_id, sp_entity_id, sp_name, sp_timezone, assigned_on, assignment_delay_seconds, is_auto_assigned (delay ≤ 3s), is_self_created (creator = SP), case_type, employer_id
- Pattern confirmed: all dashboards use business_data.public materialized tables, not raw summus schema

## Correction
- Cody redirected me from querying summus schema directly to checking business_data.public first — that's the dashboard data layer. Dashboards should never hit raw platform tables.

## Decisions
- Bootstrap is ephemeral scaffolding
- No AWS creds in committed code ever
- Git push and Redshift writes enforced via hooks, not advisory
- Round robin = new dashboard (not added to existing clin_ops)
- CaseUsers + Role='Summus Partner' is the SP assignment join pattern
- **New: need dm_sp_assignments table in business_data.public for dashboard**

## Open Threads
- Write dm_sp_assignments.sql (next immediate step)
- Wire into Hex dashboard
- Questions for Johnny re: rotation type, weekend coverage, threshold configs
- Tasks: UCSF due today, ROI deck due Mon, SMS 360 due Mon
- Cron reminders set for those deadlines

## Preferences Confirmed
- Cody wants hardened safety, not advisory
- Remove anything that could be considered credentials from committed code
- Document everything — session may reset during maintenance
- Dashboards use business_data.public, not raw summus schema
