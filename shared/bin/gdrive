#!/bin/bash
# Google Drive wrapper for Syn
# Usage: gdrive [personal|school] <rclone command> <path>

REMOTE=""
case "${1:-}" in
    personal|p)
        REMOTE="gdrive-personal"
        shift
        ;;
    school|s|ut|utexas)
        REMOTE="gdrive-school"
        shift
        ;;
    "")
        echo "Usage: gdrive [personal|school] <command> [path]"
        echo ""
        echo "Commands:"
        echo "  ls [path]     - List directory"
        echo "  cat <file>    - Show file contents"
        echo "  get <file>    - Download file"
        echo "  put <file>    - Upload file"
        echo "  find <name>   - Search for files"
        echo "  tree [path]   - Show directory tree"
        echo ""
        echo "Examples:"
        echo "  gdrive personal ls"
        echo "  gdrive school ls TEMBA/"
        echo "  gdrive s cat TEMBA/syllabus.pdf"
        exit 0
        ;;
    *)
        echo "Unknown remote: $1"
        echo "Use: personal (p) or school (s/ut/utexas)"
        exit 1
        ;;
esac

CMD="${1:-ls}"
shift

case "$CMD" in
    ls|list)
        rclone lsd "$REMOTE:$*" 2>/dev/null
        rclone ls "$REMOTE:$*" 2>/dev/null | head -50
        ;;
    cat|read)
        rclone cat "$REMOTE:$*"
        ;;
    get|download)
        rclone copy "$REMOTE:$*" .
        ;;
    put|upload)
        # put <local> <remote_path>
        LOCAL="$1"
        DEST="$2"
        rclone copy "$LOCAL" "$REMOTE:$DEST"
        ;;
    find|search)
        rclone ls "$REMOTE:" --include "*$**" 2>/dev/null | head -30
        ;;
    tree)
        rclone tree "$REMOTE:$*" --max-depth 3 2>/dev/null | head -50
        ;;
    *)
        # Pass through to rclone
        rclone "$CMD" "$REMOTE:$*"
        ;;
esac
