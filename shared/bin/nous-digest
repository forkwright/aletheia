#!/usr/bin/env bash
set -a
source /mnt/ssd/aletheia/shared/config/aletheia.env
set +a 2>/dev/null || true
set -euo pipefail

# Agent activity digest - summarizes session activity across all agents
ALETHEIA_ROOT="${ALETHEIA_ROOT:-${ALETHEIA_ROOT:-/mnt/ssd/aletheia}}"

echo "# Agent Activity Digest"
echo "*Generated: $(date -Iseconds)*"
echo ""

# Get session info for each agent
for agent in syl chiron eiron demiurge; do
    echo "## ${agent^}"
    
    # Check status file
    status_file="$ALETHEIA_ROOT/nous/syn/nous-status/${agent}.md"
    if [[ -f "$status_file" ]]; then
        modified=$(stat -c %y "$status_file" 2>/dev/null | cut -d. -f1)
        health=$(grep -m1 "Status:" "$status_file" 2>/dev/null | sed 's/.*Status://' | xargs)
        echo "- **Status:** $health"
        echo "- **Last update:** $modified"
    else
        echo "- **Status:** No report filed"
    fi
    echo ""
done

echo "## Cross-Domain"
echo "### Blocked Tasks"
"tw" +blocked 2>/dev/null || echo "None"
echo ""
echo "### Due This Week"
"tw" due.before:7d 2>/dev/null | head -10 || echo "None"
