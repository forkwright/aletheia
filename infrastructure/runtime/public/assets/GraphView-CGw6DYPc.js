const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/graph3d-14WKAbGD.js","assets/markdown-Dtr06t2G.js"])))=>i.map(i=>d[i]);
import{g as a,s as _,f as dt,a as D,p as ut,b as ft,o as pt,c as f,e as le,t as I,d as Se,h as Me,i as N,j as L,k as b,l as c,m as ce,n as A,q as vt,r as mt,u as Ne,v as gt,_ as ht,w as z,x as k,y as _t}from"./index-Bcgmyn7g.js";import{S as yt,M as bt,a as kt,B as wt,C as xt,b as Ct,c as St,d as Mt}from"./graph3d-14WKAbGD.js";import"./markdown-Dtr06t2G.js";const Oe={nodes:[],edges:[],communities:0,community_meta:[],total_nodes:0};let O=D(ut(Oe)),ue=D(!1),fe=D(null),Z=D(null),De=D(null),Ie=D(""),Ae=D("top"),ze=D(200);function H(){return a(O)}function j(){return a(ue)}function Ee(){return a(fe)}function B(){return a(Z)}function J(i){_(Z,i,!0)}function q(){return a(De)}function X(i){_(De,i,!0)}function Nt(){return a(Ie)}function Et(i){_(Ie,i,!0)}function Tt(){return a(Z)?a(O).nodes.find(i=>i.id===a(Z))??null:null}function Lt(i){return a(O).edges.filter(d=>d.source===i||d.target===i)}function Ot(i){const d=new Set;for(const l of a(O).edges)l.source===i&&d.add(l.target),l.target===i&&d.add(l.source);return a(O).nodes.filter(l=>d.has(l.id))}function Dt(){const i=new Set;for(const d of a(O).nodes)d.community>=0&&i.add(d.community);return[...i].sort((d,l)=>d-l)}function de(){return a(Ae)}function It(){return a(ze)}function Te(){return a(O).total_nodes}async function Le(i){_(ue,!0),_(fe,null);try{_(O,await dt(i),!0),_(Ae,(i==null?void 0:i.mode)??"top",!0),_(ze,(i==null?void 0:i.limit)??200,!0)}catch(d){_(fe,d instanceof Error?d.message:String(d),!0),_(O,Oe,!0)}finally{_(ue,!1)}}var At=k("<button> </button>"),zt=k('<button class="pill load-more svelte-1186pna">+ More</button>'),Rt=k('<div class="graph-loading svelte-1186pna">Loading graph...</div>'),$t=k('<div class="graph-error svelte-1186pna"> </div>'),Pt=k('<span class="label-tag svelte-1186pna"> </span>'),Wt=k('<div class="info-labels svelte-1186pna"></div>'),Ft=k('<div class="connection-row svelte-1186pna"><span class="rel-type svelte-1186pna"> </span> <button class="connection-target svelte-1186pna"> </button></div>'),Gt=k('<div class="connection-overflow svelte-1186pna"> </div>'),Ht=k('<div class="info-connections svelte-1186pna"><!> <!></div>'),Bt=k('<div class="info-panel svelte-1186pna"><div class="info-header svelte-1186pna"><span class="info-dot svelte-1186pna"></span> <strong class="svelte-1186pna"> </strong> <span class="info-meta svelte-1186pna"> </span> <button class="info-close svelte-1186pna">✕</button></div> <!> <!></div>'),qt=k('<div class="graph-view svelte-1186pna"><div class="graph-toolbar svelte-1186pna"><input class="graph-search svelte-1186pna" type="text" placeholder="Search nodes..."/> <div class="community-pills svelte-1186pna"><button>All</button> <!></div> <div class="load-controls svelte-1186pna"><select class="mode-select svelte-1186pna"><option>Top nodes</option><option>All nodes</option></select> <!></div> <button class="pill refresh-btn svelte-1186pna" title="Reload graph data"> </button> <span class="graph-stats svelte-1186pna"> </span></div> <div class="graph-container svelte-1186pna"><!> <!></div> <!></div>');function Ut(i,d){ft(d,!0);let l,u=null,ee=D(null);const pe=["#58a6ff","#3fb950","#d29922","#f85149","#bc8cff","#f778ba","#79c0ff","#56d4dd","#e3b341","#db6d28","#8b949e","#7ee787","#a5d6ff","#ffa657","#ff7b72","#d2a8ff","#ffd8b5","#89dceb","#f9e2af","#a6e3a1"];function W(t){return t<0?"#30363d":pe[t%pe.length]}function Re(t){const n=Math.max(t,1e-4),o=(Math.log(n)+10)/10;return Math.max(2,Math.min(14,o*12))}function $e(t){const n=["KNOWS","LIVES_WITH","FAMILY_OF","WORKS_WITH","COMMUNICATES_WITH"],o=["PART_OF","CONTAINS","DEPENDS_ON","INSTANCE_OF","LOCATED_AT"],r=["PRECEDES","FOLLOWS","OCCURRED_AT","MENTIONS"];return n.includes(t)?"rgba(63, 185, 80, 0.35)":o.includes(t)?"rgba(88, 166, 255, 0.35)":r.includes(t)?"rgba(210, 153, 34, 0.35)":"rgba(139, 148, 158, 0.25)"}const ve=new yt(1,24,16),R=new Map,$=new Map;let y=null;function Pe(t,n){return new kt({color:new xt(t),transparent:!0,opacity:n,depthWrite:!1,side:wt})}function We(t,n){const o=document.createElement("canvas"),r=o.getContext("2d");o.width=512,o.height=64,r.font="bold 28px system-ui, -apple-system, sans-serif",r.fillStyle=n,r.globalAlpha=.8,r.textAlign="center",r.textBaseline="middle";const e=t.length>30?t.slice(0,27)+"...":t;r.fillText(e,256,32);const s=new Ct(o),p=new St({map:s,transparent:!0,depthWrite:!1}),g=new Mt(p);return g.scale.set(60,8,1),g.renderOrder=10,g}function Fe(t){var r;if(!y)return;const n=new Map;for(const e of t){if(e.community==null||e.community<0||e.x==null)continue;const s=n.get(e.community)||[];s.push(e),n.set(e.community,s)}for(const[e,s]of R)n.has(e)||(y.remove(s),s.material.dispose(),R.delete(e));for(const[e,s]of $)n.has(e)||(y.remove(s),(r=s.material.map)==null||r.dispose(),s.material.dispose(),$.delete(e));const o=q();for(const[e,s]of n){if(s.length<3)continue;let p=0,g=0,E=0;for(const v of s)p+=v.x,g+=v.y,E+=v.z;p/=s.length,g/=s.length,E/=s.length;let F=0;for(const v of s){const T=v.x-p,C=v.y-g,S=v.z-E;F+=T*T+C*C+S*S}const ie=Math.sqrt(F/s.length),U=Math.max(ie*1.5,25);let x=R.get(e);if(!x){const v=W(e);x=new bt(ve,Pe(v,.06)),x.renderOrder=-1,y.add(x),R.set(e,x)}x.position.set(p,g,E),x.scale.setScalar(U);const h=x.material;o===null?h.opacity=.06:e===o?h.opacity=.12:h.opacity=.02;let m=$.get(e);if(!m){const v=s.reduce((T,C)=>(T.pagerank||0)>(C.pagerank||0)?T:C);m=We(v.id,W(e)),y.add(m),$.set(e,m)}m.position.set(p,g+U*.9,E),m.material.opacity=o===null?.6:e===o?.9:.15}}function me(){var t;if(y){for(const[,n]of R)y.remove(n),n.material.dispose();for(const[,n]of $)y.remove(n),(t=n.material.map)==null||t.dispose(),n.material.dispose();R.clear(),$.clear(),y=null}}function te(t){if(!u)return;const o=u.graphData().nodes.find(s=>s.id===t);if(!o)return;const e=1+120/Math.hypot(o.x||0,o.y||0,o.z||0);u.cameraPosition({x:(o.x||0)*e,y:(o.y||0)*e,z:(o.z||0)*e},o,1e3),J(t)}function ge(t){const n=t.target;if(Et(n.value),!n.value.trim())return;const o=H(),r=n.value.toLowerCase(),e=o.nodes.find(s=>s.id.toLowerCase().includes(r));e&&te(e.id)}function Ge(t){t.key==="Enter"&&ge(t)}function He(t){const n=t.target.value;P({mode:n})}function Be(){const t=It()+100;P({mode:"top",limit:t})}function qe(t){q()===t?(X(null),P()):(X(t),P({mode:"community",community:t}))}async function P(t){if(me(),await Le(t),!u||!l)return;const n=H(),o={nodes:n.nodes.map(r=>({...r})),links:n.edges.map(r=>({source:r.source,target:r.target,rel_type:r.rel_type}))};u.graphData(o),y=u.scene(),setTimeout(()=>{u&&u.zoomToFit(500,50)},2e3)}async function Ve(){if(await Le(),!l)return;const t=(await ht(async()=>{const{default:e}=await import("./graph3d-14WKAbGD.js").then(s=>s._);return{default:e}},__vite__mapDeps([0,1]))).default,n=H(),o={nodes:n.nodes.map(e=>({...e})),links:n.edges.map(e=>({source:e.source,target:e.target,rel_type:e.rel_type}))};u=new t(l).backgroundColor("#0a0a0f").showNavInfo(!1).width(l.clientWidth).height(l.clientHeight).graphData(o).nodeId("id").nodeVal(e=>Re(e.pagerank||.001)).nodeColor(e=>{if(a(ee)&&e.id===a(ee)||B()===e.id)return"#ffffff";const s=q();return s!==null&&e.community!==s?"rgba(48, 54, 61, 0.4)":W(e.community??-1)}).nodeLabel(e=>{const s=e.pagerank?e.pagerank.toFixed(4):"—",p=e.community>=0?e.community:"—";return`<span style="color:#e6edf3;font-family:system-ui;font-size:12px">
          <b>${e.id}</b><br/>
          Community ${p} · PR ${s}
        </span>`}).nodeOpacity(.9).linkSource("source").linkTarget("target").linkColor(e=>$e(e.rel_type)).linkWidth(.5).linkOpacity(.6).linkDirectionalArrowLength(3).linkDirectionalArrowRelPos(1).linkLabel(e=>`<span style="color:#8b949e;font-size:11px">${e.rel_type}</span>`).onNodeClick(e=>{J(e.id),te(e.id)}).onNodeHover(e=>{_(ee,(e==null?void 0:e.id)??null,!0),l.style.cursor=e?"pointer":"default"}).onBackgroundClick(()=>{J(null),X(null)}).warmupTicks(100).cooldownTime(3e3).onEngineTick(()=>{const e=u.graphData();Fe(e.nodes)}),y=u.scene();const r=new ResizeObserver(()=>{u&&l&&u.width(l.clientWidth).height(l.clientHeight)});return r.observe(l),setTimeout(()=>{u&&u.zoomToFit(500,50)},3500),()=>{r.disconnect(),me(),ve.dispose(),u&&u._destructor()}}pt(()=>{let t;return Ve().then(n=>{t=n}),()=>t==null?void 0:t()});let w=z(Tt),ne=z(()=>B()?Lt(B()):[]),Ke=z(()=>B()?Ot(B()):[]),Qe=z(Dt);var he=qt(),_e=c(he),V=c(_e),ye=f(V,2),ae=c(ye);let be;var Ue=f(ae,2);le(Ue,17,()=>a(Qe).slice(0,12),ce,(t,n)=>{var o=At();let r;var e=c(o);I((s,p)=>{r=Se(o,1,"pill svelte-1186pna",null,r,s),Me(o,`--pill-color: ${p??""}`),N(e,a(n))},[()=>({active:q()===a(n)}),()=>W(a(n))]),L("click",o,()=>qe(a(n))),b(t,o)});var ke=f(ye,2),oe=c(ke),K=c(oe);K.value=K.__value="top";var se=f(K);se.value=se.__value="all";var Ye=f(oe,2);{var je=t=>{var n=zt();I(o=>n.disabled=o,[j]),L("click",n,Be),b(t,n)},Je=z(()=>de()==="top");A(Ye,t=>{a(Je)&&t(je)})}var Q=f(ke,2),Xe=c(Q),Ze=f(Q,2),et=c(Ze),re=f(_e,2),we=c(re);{var tt=t=>{var n=Rt();b(t,n)},nt=z(()=>j());A(we,t=>{a(nt)&&t(tt)})}var at=f(we,2);{var ot=t=>{var n=$t(),o=c(n);I(r=>N(o,r),[Ee]),b(t,n)},st=z(()=>Ee());A(at,t=>{a(st)&&t(ot)})}vt(re,t=>l=t,()=>l);var rt=f(re,2);{var it=t=>{var n=Bt(),o=c(n),r=c(o),e=f(r,2),s=c(e),p=f(e,2),g=c(p),E=f(p,2),F=f(o,2);{var ie=h=>{var m=Wt();le(m,21,()=>a(w).labels,ce,(v,T)=>{var C=Pt(),S=c(C);I(()=>N(S,a(T))),b(v,C)}),b(h,m)};A(F,h=>{a(w).labels.length>0&&h(ie)})}var U=f(F,2);{var x=h=>{var m=Ht(),v=c(m);le(v,17,()=>a(ne).slice(0,20),ce,(S,M)=>{var Y=Ft(),xe=c(Y),lt=c(xe),Ce=f(xe,2),ct=c(Ce);I(()=>{var G;N(lt,a(M).rel_type),N(ct,a(M).source===((G=a(w))==null?void 0:G.id)?a(M).target:a(M).source)}),L("click",Ce,()=>{var G;return te(a(M).source===((G=a(w))==null?void 0:G.id)?a(M).target:a(M).source)}),b(S,Y)});var T=f(v,2);{var C=S=>{var M=Gt(),Y=c(M);I(()=>N(Y,`+${a(ne).length-20} more`)),b(S,M)};A(T,S=>{a(ne).length>20&&S(C)})}b(h,m)};A(U,h=>{a(Ke).length>0&&h(x)})}I((h,m)=>{Me(r,`background: ${h??""}`),N(s,a(w).id),N(g,`Community ${(a(w).community>=0?a(w).community:"—")??""} ·
          PR ${m??""}`)},[()=>W(a(w).community),()=>a(w).pagerank.toFixed(4)]),L("click",E,()=>J(null)),b(t,n)};A(rt,t=>{a(w)&&t(it)})}I((t,n,o,r,e,s,p,g,E)=>{mt(V,t),be=Se(ae,1,"pill svelte-1186pna",null,be,n),Ne(K,o),Ne(se,r),Q.disabled=e,N(Xe,s),N(et,`${p??""}${g??""} nodes · ${E??""} edges`)},[Nt,()=>({active:q()===null}),()=>de()==="top",()=>de()==="all",j,()=>j()?"...":"Refresh",()=>H().nodes.length,()=>Te()>0?` of ${Te()}`:"",()=>H().edges.length]),L("input",V,ge),L("keydown",V,Ge),L("click",ae,()=>{X(null),P()}),L("change",oe,He),L("click",Q,()=>P()),b(i,he),gt()}_t(["input","keydown","click","change"]);export{Ut as default};
